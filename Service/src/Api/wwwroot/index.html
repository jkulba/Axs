<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Axs Control Service</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            margin: 0;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 30px;
        }

        h1 {
            color: #2c3e50;
            margin-top: 0;
        }

        h2 {
            color: #3498db;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-top: 30px;
        }

        .endpoint {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .method {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 3px;
            color: white;
            font-weight: bold;
            margin-right: 10px;
        }

        .get {
            background-color: #61affe;
        }

        .post {
            background-color: #49cc90;
        }

        .put {
            background-color: #fca130;
        }

        .delete {
            background-color: #f93e3e;
        }

        .path {
            font-family: monospace;
            font-size: 1.1em;
        }

        .description {
            margin-top: 15px;
        }

        .parameters {
            margin-top: 15px;
        }

        .response {
            margin-top: 15px;
        }

        code {
            background-color: #f8f8f8;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: monospace;
        }

        pre {
            background-color: #f8f8f8;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #3498db;
            overflow-x: auto;
            margin: 10px 0;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        th,
        td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f2f2f2;
        }

        .note {
            background-color: #fff8dc;
            padding: 10px;
            border-left: 4px solid #ffd700;
            margin: 15px 0;
        }

        a {
            color: #3498db;
            text-decoration: none;
        }

        a:hover {
            color: #2980b9;
            text-decoration: underline;
        }
    </style>
</head>

<body>
    <header>
        <h1>
            <img src="axs-logo-512.png" alt="Axs" style="vertical-align: middle; width: 50px; height: 50px;">
            Axs Control Service API Documentation
        </h1>
        <p>Documentation for the Axs Control Service REST API endpoints</p>
    </header>

    <h2>Swagger and Open API Endpoints</h2>

    <div class="endpoint">
        <div class="parameters">
            <h3>Swagger UI URLs</h3>
            <table>
                <tr>
                    <th>Protocol</th>
                    <th>Path</th>
                </tr>
                <tr>
                    <td>HTTP</td>
                    <td><a href="http://localhost:5001/swagger" target="_blank">http://localhost:5001/swagger</a></td>
                </tr>
                <tr>
                    <td>HTTPS</td>
                    <td><a href="https://localhost:7001/swagger/index.html"
                            target="_blank">https://localhost:7001/swagger/index.html</a></td>
                </tr>

            </table>
        </div>

        <div class="parameters">
            <h3>OpenAPI Specification URLs</h3>
            <table>
                <tr>
                    <th>Protocol</th>
                    <th>Path</th>
                </tr>
                <tr>
                    <td>HTTP</td>
                    <td><a href="http://localhost:5001/openapi/v1.json"
                            target="_blank">http://localhost:5001/openapi/v1.json</a></td>
                </tr>
                <tr>
                    <td>HTTPS</td>
                    <td><a href="https://localhost:7001/openapi/v1.json"
                            target="_blank">https://localhost:7001/openapi/v1.json</a></td>
                </tr>

            </table>
        </div>

        <div class="note">
            <strong>Note:</strong> The Swagger and OpenApi Endpoints are only availabe when running in Developement
            mode.
        </div>
    </div>

    <h2>Access Request API Endpoints</h2>

    <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/api/access-requests</span>

        <div class="description">
            <h3>Get All Access Requests</h3>
            <p>Retrieves a list of all access requests in the system. Returns an array of access request objects with
                all their properties.</p>
        </div>

        <div class="response">
            <h3>Responses</h3>
            <table>
                <tr>
                    <th>Status Code</th>
                    <th>Description</th>
                    <th>Content Type</th>
                </tr>
                <tr>
                    <td><code>200</code></td>
                    <td>Successful response with access requests</td>
                    <td>application/json</td>
                </tr>
                <tr>
                    <td><code>500</code></td>
                    <td>Internal server error</td>
                    <td>application/problem+json</td>
                </tr>
            </table>
        </div>

        <div class="parameters">
            <h3>Example Request</h3>
            <p><code>GET /api/access-requests</code></p>
        </div>

        <div class="response">
            <h3>Example Response (200 OK)</h3>
            <p>Returns an array of <code>AccessRequest</code> objects.</p>
            <pre><code>[
  {
    "requestId": 1,
    "requestCode": "123e4567-e89b-12d3-a456-426614174000",
    "userName": "john.doe",
    "jobNumber": 12345,
    "cycleNumber": 1,
    "activityCode": "REVIEW",
    "applicationName": "ProFile",
    "version": "2025.1",
    "workstation": "WORKSTATION-01",
    "utcCreatedAt": "2025-08-14T10:30:00Z"
  }
]</code></pre>
        </div>
    </div>

    <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/api/access-requests/{id}</span>

        <div class="description">
            <h3>Get Access Request by ID</h3>
            <p>Retrieves a single access request by its unique identifier (RequestId).</p>
        </div>

        <div class="parameters">
            <h3>Path Parameters</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <th>Type</th>
                    <th>Required</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><code>id</code></td>
                    <td>integer</td>
                    <td>Yes</td>
                    <td>The unique identifier of the access request</td>
                </tr>
            </table>
        </div>

        <div class="response">
            <h3>Responses</h3>
            <table>
                <tr>
                    <th>Status Code</th>
                    <th>Description</th>
                    <th>Content Type</th>
                </tr>
                <tr>
                    <td><code>200</code></td>
                    <td>Successful response with access request</td>
                    <td>application/json</td>
                </tr>
                <tr>
                    <td><code>404</code></td>
                    <td>Access request not found</td>
                    <td>application/problem+json</td>
                </tr>
                <tr>
                    <td><code>500</code></td>
                    <td>Internal server error</td>
                    <td>application/problem+json</td>
                </tr>
            </table>
        </div>

        <div class="parameters">
            <h3>Example Request</h3>
            <p><code>GET /api/access-requests/1</code></p>
        </div>
    </div>

    <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/api/access-requests/by-request-code/{requestCode}</span>

        <div class="description">
            <h3>Get Access Request by Request Code</h3>
            <p>Retrieves a single access request by its unique request code (GUID).</p>
        </div>

        <div class="parameters">
            <h3>Path Parameters</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <th>Type</th>
                    <th>Required</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><code>requestCode</code></td>
                    <td>GUID</td>
                    <td>Yes</td>
                    <td>The unique request code of the access request</td>
                </tr>
            </table>
        </div>

        <div class="response">
            <h3>Responses</h3>
            <table>
                <tr>
                    <th>Status Code</th>
                    <th>Description</th>
                    <th>Content Type</th>
                </tr>
                <tr>
                    <td><code>200</code></td>
                    <td>Successful response with access request</td>
                    <td>application/json</td>
                </tr>
                <tr>
                    <td><code>404</code></td>
                    <td>Access request not found</td>
                    <td>application/problem+json</td>
                </tr>
                <tr>
                    <td><code>500</code></td>
                    <td>Internal server error</td>
                    <td>application/problem+json</td>
                </tr>
            </table>
        </div>

        <div class="parameters">
            <h3>Example Request</h3>
            <p><code>GET /api/access-requests/by-request-code/123e4567-e89b-12d3-a456-426614174000</code></p>
        </div>
    </div>

    <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/api/access-requests/by-job-number/{jobNumber}</span>

        <div class="description">
            <h3>Get Access Requests by Job Number</h3>
            <p>Retrieves all access requests associated with a specific job number. Returns them ordered by creation
                date (most recent first).</p>
        </div>

        <div class="parameters">
            <h3>Path Parameters</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <th>Type</th>
                    <th>Required</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><code>jobNumber</code></td>
                    <td>integer</td>
                    <td>Yes</td>
                    <td>The job number to filter access requests by</td>
                </tr>
            </table>
        </div>

        <div class="response">
            <h3>Responses</h3>
            <table>
                <tr>
                    <th>Status Code</th>
                    <th>Description</th>
                    <th>Content Type</th>
                </tr>
                <tr>
                    <td><code>200</code></td>
                    <td>Successful response with access requests (may be empty array)</td>
                    <td>application/json</td>
                </tr>
                <tr>
                    <td><code>500</code></td>
                    <td>Internal server error</td>
                    <td>application/problem+json</td>
                </tr>
            </table>
        </div>

        <div class="parameters">
            <h3>Example Request</h3>
            <p><code>GET /api/access-requests/by-job-number/12345</code></p>
        </div>
    </div>

    <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/api/access-requests/by-user/{userName}</span>

        <div class="description">
            <h3>Get Access Requests by User Name</h3>
            <p>Retrieves all access requests associated with a specific user name. Returns them ordered by creation date
                (most recent first).</p>
        </div>

        <div class="parameters">
            <h3>Path Parameters</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <th>Type</th>
                    <th>Required</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><code>userName</code></td>
                    <td>string</td>
                    <td>Yes</td>
                    <td>The user name to filter access requests by</td>
                </tr>
            </table>
        </div>

        <div class="response">
            <h3>Responses</h3>
            <table>
                <tr>
                    <th>Status Code</th>
                    <th>Description</th>
                    <th>Content Type</th>
                </tr>
                <tr>
                    <td><code>200</code></td>
                    <td>Successful response with access requests (may be empty array)</td>
                    <td>application/json</td>
                </tr>
                <tr>
                    <td><code>500</code></td>
                    <td>Internal server error</td>
                    <td>application/problem+json</td>
                </tr>
            </table>
        </div>

        <div class="parameters">
            <h3>Example Request</h3>
            <p><code>GET /api/access-requests/by-user/john.doe</code></p>
        </div>
    </div>

    <div class="endpoint">
        <span class="method post">POST</span>
        <span class="path">/api/access-requests</span>

        <div class="description">
            <h3>Create New Access Request</h3>
            <p>Creates a new access request using the CreateAccessRequestCommand. The command uses a simplified
                structure
                focused on essential creation parameters. If RequestCode is not provided or is empty, a new GUID will be
                generated
                automatically. If UtcCreatedAt is not provided, the current UTC time will be used.</p>
        </div>

        <div class="parameters">
            <h3>Request Body (JSON) - CreateAccessRequestCommand</h3>
            <table>
                <tr>
                    <th>Property</th>
                    <th>Type</th>
                    <th>Required</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><code>requestCode</code></td>
                    <td>GUID</td>
                    <td>No</td>
                    <td>Auto-generated if not provided or empty</td>
                </tr>
                <tr>
                    <td><code>userName</code></td>
                    <td>string</td>
                    <td>Yes</td>
                    <td>The user requesting access (max 100 chars, alphanumeric with ._@-)</td>
                </tr>
                <tr>
                    <td><code>jobNumber</code></td>
                    <td>string</td>
                    <td>Yes</td>
                    <td>The job number for the request (max 50 chars, must be valid positive integer)</td>
                </tr>
                <tr>
                    <td><code>utcCreatedAt</code></td>
                    <td>datetime</td>
                    <td>No</td>
                    <td>Auto-set to current UTC time if not provided (cannot be future-dated)</td>
                </tr>
            </table>
            <p><em>Note: The Command uses FluentValidation to ensure data integrity before processing.</em></p>
        </div>

        <div class="response">
            <h3>Responses</h3>
            <table>
                <tr>
                    <th>Status Code</th>
                    <th>Description</th>
                    <th>Content Type</th>
                </tr>
                <tr>
                    <td><code>201</code></td>
                    <td>Access request created successfully</td>
                    <td>application/json</td>
                </tr>
                <tr>
                    <td><code>400</code></td>
                    <td>Invalid request data</td>
                    <td>application/problem+json</td>
                </tr>
                <tr>
                    <td><code>500</code></td>
                    <td>Internal server error</td>
                    <td>application/problem+json</td>
                </tr>
            </table>
        </div>

        <div class="parameters">
            <h3>Example Request - CreateAccessRequestCommand</h3>
            <p><code>POST /api/access-requests</code></p>
            <pre><code>{
  "userName": "john.doe",
  "jobNumber": "12345"
}</code></pre>
            <p><em>Minimal command example - RequestCode and UtcCreatedAt will be auto-generated.</em></p>
        </div>

        <div class="response">
            <h3>Example Response (201 Created)</h3>
            <pre><code>{
  "requestId": 1,
  "requestCode": "123e4567-e89b-12d3-a456-426614174000",
  "userName": "john.doe",
  "jobNumber": 12345,
  "cycleNumber": 1,
  "activityCode": "REVIEW",
  "applicationName": "ProFile",
  "version": "2025.1",
  "workstation": "WORKSTATION-01",
  "utcCreatedAt": "2025-08-14T10:30:00Z"
}</code></pre>
        </div>
    </div>



    <div class="endpoint">
        <span class="method delete">DELETE</span>
        <span class="path">/api/access-requests/{id}</span>

        <div class="description">
            <h3>Delete Access Request</h3>
            <p>Deletes an existing access request by its ID using the DeleteAccessRequestCommand.
                The command returns the number of affected rows for confirmation.</p>
        </div>

        <div class="parameters">
            <h3>Path Parameters</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <th>Type</th>
                    <th>Required</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><code>id</code></td>
                    <td>integer</td>
                    <td>Yes</td>
                    <td>The unique identifier of the access request to delete</td>
                </tr>
            </table>
        </div>

        <div class="response">
            <h3>Responses</h3>
            <table>
                <tr>
                    <th>Status Code</th>
                    <th>Description</th>
                    <th>Content Type</th>
                </tr>
                <tr>
                    <td><code>204</code></td>
                    <td>Access request deleted successfully</td>
                    <td>-</td>
                </tr>
                <tr>
                    <td><code>404</code></td>
                    <td>Access request not found</td>
                    <td>application/problem+json</td>
                </tr>
                <tr>
                    <td><code>500</code></td>
                    <td>Internal server error</td>
                    <td>application/problem+json</td>
                </tr>
            </table>
        </div>

        <div class="parameters">
            <h3>Example Request</h3>
            <p><code>DELETE /api/access-requests/1</code></p>
        </div>
    </div>

    <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/api/access-requests/exists/{requestCode}</span>

        <div class="description">
            <h3>Check if Access Request Exists</h3>
            <p>Checks if an access request exists with the specified request code. Returns a boolean value.</p>
        </div>

        <div class="parameters">
            <h3>Path Parameters</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <th>Type</th>
                    <th>Required</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><code>requestCode</code></td>
                    <td>GUID</td>
                    <td>Yes</td>
                    <td>The request code to check for existence</td>
                </tr>
            </table>
        </div>

        <div class="response">
            <h3>Responses</h3>
            <table>
                <tr>
                    <th>Status Code</th>
                    <th>Description</th>
                    <th>Content Type</th>
                </tr>
                <tr>
                    <td><code>200</code></td>
                    <td>Returns boolean indicating existence</td>
                    <td>application/json</td>
                </tr>
                <tr>
                    <td><code>500</code></td>
                    <td>Internal server error</td>
                    <td>application/problem+json</td>
                </tr>
            </table>
        </div>

        <div class="parameters">
            <h3>Example Request</h3>
            <p><code>GET /api/access-requests/exists/123e4567-e89b-12d3-a456-426614174000</code></p>
        </div>

        <div class="response">
            <h3>Example Response (200 OK)</h3>
            <pre><code>true</code></pre>
        </div>
    </div>

    <h2>Architecture Overview</h2>

    <div class="note">
        <strong>CQRS (Command Query Responsibility Segregation) Architecture:</strong> This API implements the CQRS
        pattern
        to separate read (Query) and write (Command) operations, providing better scalability, maintainability, and
        performance.

        <h3>Key Components:</h3>
        <ul>
            <li><strong>Commands</strong>: Handle write operations (Create, Delete) through the Command pipeline</li>
            <li><strong>Queries</strong>: Handle read operations (Get, Exists) through the Query pipeline</li>
            <li><strong>Handlers</strong>: Execute specific Commands or Queries with dedicated business logic</li>
            <li><strong>Dispatchers</strong>: Route Commands and Queries to their respective handlers</li>
            <li><strong>Pipeline Behaviors</strong>: Cross-cutting concerns like validation, performance monitoring, and
                logging</li>
        </ul>

        <h3>Available Commands:</h3>
        <ul>
            <li><strong>CreateAccessRequestCommand</strong>: Creates new access requests with automatic GUID generation
            </li>
            <li><strong>DeleteAccessRequestCommand</strong>: Deletes existing access requests by ID</li>
        </ul>

        <h3>Available Queries:</h3>
        <ul>
            <li><strong>GetAccessRequestsQuery</strong>: Retrieves all access requests</li>
            <li><strong>GetAccessRequestByIdQuery</strong>: Retrieves single access request by ID</li>
            <li><strong>GetAccessRequestByRequestCodeQuery</strong>: Retrieves single access request by GUID</li>
            <li><strong>GetAccessRequestsByJobNumberQuery</strong>: Retrieves access requests filtered by job number
            </li>
            <li><strong>GetAccessRequestsByUserNameQuery</strong>: Retrieves access requests filtered by user name</li>
            <li><strong>ExistsAccessRequestByRequestCodeQuery</strong>: Checks existence by request code</li>
        </ul>

        <h3>Pipeline Behaviors:</h3>
        <ul>
            <li><strong>Validation Behaviors</strong>: FluentValidation integration for Commands and Queries</li>
            <li><strong>Performance Behaviors</strong>: Performance monitoring with configurable thresholds</li>
            <li><strong>Error Handling</strong>: Comprehensive error handling and logging throughout the pipeline</li>
        </ul>

        <h3>Benefits of CQRS Implementation:</h3>
        <ul>
            <li><strong>Separation of Concerns</strong>: Clear distinction between read and write operations</li>
            <li><strong>Scalability</strong>: Independent optimization of read and write operations</li>
            <li><strong>Maintainability</strong>: Focused handlers with single responsibilities</li>
            <li><strong>Extensibility</strong>: Easy addition of cross-cutting behaviors through pipeline</li>
            <li><strong>Testability</strong>: Individual handlers can be unit tested independently</li>
        </ul>
    </div>

    <h2>Implementation Details</h2>

    <div class="note">
        <strong>CQRS Implementation Stack:</strong>

        <h3>Minimal API Integration:</h3>
        <ul>
            <li><strong>Endpoint Registration</strong>: All endpoints are registered as Minimal APIs in
                <code>AccessRequestEndpoints.cs</code>
            </li>
            <li><strong>Dispatcher Injection</strong>: Each endpoint receives <code>ICommandDispatcher</code> or
                <code>IQueryDispatcher</code> via dependency injection
            </li>
            <li><strong>Result Handling</strong>: Commands and Queries return <code>Result&lt;T&gt;</code> objects for
                consistent error handling</li>
            <li><strong>HTTP Response Mapping</strong>: Results are automatically mapped to appropriate HTTP status
                codes</li>
        </ul>

        <h3>Command Processing Pipeline:</h3>
        <ol>
            <li><strong>Command Reception</strong>: Minimal API endpoint receives command object</li>
            <li><strong>Dispatcher Invocation</strong>:
                <code>ICommandDispatcher.Dispatch&lt;TCommand, TResult&gt;()</code> called
            </li>
            <li><strong>Validation Behavior</strong>: FluentValidation rules executed via
                <code>CommandValidationBehavior</code>
            </li>
            <li><strong>Performance Monitoring</strong>: Execution time tracked via
                <code>CommandPerformanceBehavior</code>
            </li>
            <li><strong>Handler Execution</strong>: Specific <code>ICommandHandler&lt;TCommand, TResult&gt;</code>
                processes the command</li>
            <li><strong>Result Return</strong>: <code>Result&lt;T&gt;</code> returned through pipeline and converted to
                HTTP response</li>
        </ol>

        <h3>Query Processing Pipeline:</h3>
        <ol>
            <li><strong>Query Reception</strong>: Minimal API endpoint creates query object from parameters</li>
            <li><strong>Dispatcher Invocation</strong>: <code>IQueryDispatcher.Dispatch&lt;TQuery, TResult&gt;()</code>
                called</li>
            <li><strong>Validation Behavior</strong>: Query validation via <code>QueryValidationBehavior</code> (if
                applicable)</li>
            <li><strong>Performance Monitoring</strong>: Execution time tracked via
                <code>QueryPerformanceBehavior</code>
            </li>
            <li><strong>Handler Execution</strong>: Specific <code>IQueryHandler&lt;TQuery, TResult&gt;</code> processes
                the query</li>
            <li><strong>Result Return</strong>: <code>Result&lt;T&gt;</code> returned through pipeline and converted to
                HTTP response</li>
        </ol>

        <h3>Validation Integration:</h3>
        <ul>
            <li><strong>FluentValidation 12.0.0</strong>: Comprehensive validation rules for all commands</li>
            <li><strong>Automatic GUID Generation</strong>: Service generates RequestCode if not provided in
                CreateAccessRequestCommand</li>
            <li><strong>Business Rule Validation</strong>: Custom validation rules for JobNumber format and UserName
                patterns</li>
            <li><strong>DateTime Validation</strong>: Prevents future-dated timestamps with clock skew tolerance</li>
        </ul>
    </div>

    <div class="note">
        <strong>Note:</strong> All endpoints use the CQRS pattern with Command/Query dispatchers for data operations and
        include comprehensive error
        handling and logging. The AccessRequest entity includes the following data model:
        <ul>
            <li><strong>RequestId</strong>: Primary key (integer)</li>
            <li><strong>RequestCode</strong>: Unique GUID identifier</li>
            <li><strong>UserName</strong>: User requesting access (required)</li>
            <li><strong>JobNumber</strong>: Associated job number (integer)</li>
            <li><strong>CycleNumber</strong>: Job cycle number (integer)</li>
            <li><strong>ActivityCode</strong>: Optional activity code</li>
            <li><strong>Application</strong>: Optional application name</li>
            <li><strong>Version</strong>: Optional application version</li>
            <li><strong>Workstation</strong>: Optional workstation name</li>
            <li><strong>UtcCreatedAt</strong>: Creation timestamp (UTC)</li>
        </ul>
    </div>

    <footer>
        <p>Axs Control Service API Documentation - Last Updated on August 15, 2025</p>
    </footer>
</body>

</html>